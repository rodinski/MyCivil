use strict;
use warnings;
use feature 'say';
use YAML;
use Data::Dumper;
use Math::Spline;

# ^----span1----------^----span2------^---span_N
# nth  (10 per span) 
# 0 1 2 3 4 5 6 7 8 9 X 11  ...
#
#
my @spans; #will need this later
my @nth; # an array of points along span
my $ref = \@nth; #ref to the above array
while(my $row = <DATA>) {
    $row = clean($row);
    if ($row =~/^ +SPN /) {
        $row = trim($row); #drop leading spaces
        @spans = split /\s+/, $row;
        shift @spans;  #now @spans only has span lengths
  
        my $current_span = -1;
        my $current_point = 0;

        $nth[0]->{d_along_span}=0;
        $nth[0]->{d_along_total}=0;
        my $left_support = 0;
        foreach my $span (@spans) {
            $current_span++;
            foreach my $n (1 .. 10) {
               $current_point++;
                $nth[$current_point]->{d_along_span}= $n / 10 * $spans[$current_span];
                $nth[$current_point]->{d_along_total}= $left_support + $nth[$current_point]->{d_along_span};
                $nth[$current_point]->{index} = $current_point;  #not needed but nice to have.
                if ($n == 10) {$left_support += $spans[$current_span]};
            }
        }
    }
#    my $sup = 0;
#    if ($row =~/^ +Service Deflections -/) {
#        until ($row =~/SUPPORT/) {$row =<$fh>} 
#        $sup++;
#        say rtrim($row);
#        until ($row =~ /^\s*$/) {
#            $row =<$fh>;
#            say clean($row);
#        } 
#    }
}
for my $i ( 0 .. 40) {
format =
@###  @###.##  @###.##
$i, $nth[$i]->{d_along_span}, $nth[$i]{d_along_total}
.
    write ;
}
say Dump ($ref); 
# ===================================
sub ltrim { my $s = shift; $s =~ s/^\s+//;       return $s };
sub rtrim { my $s = shift; $s =~ s/\s+$//;       return $s };
sub  trim { my $s = shift; $s =~ s/^\s+|\s+$//g; return $s };
sub clean { 
    my $s = shift; 
    chomp $s; 
    rtrim $s; 
    return $s;
}
__DATA__

         SPN 125.  180.  180.  125.                                                                        


  Service Deflections - in


                Noncomp Noncomp Noncomp Comp    Comp    Live+I  Live+I
                Dead    Dead    Dead    Dead    Dead    Max     Max
                Total   Steel   Slab    Excldg  Wearng  Up      Down
                        Only    Only    Wearng  Surfce
                                                Only
SUPPORT         0.000   0.000   0.000   0.000   0.000   0.000   0.000
   1            0.376   0.095   0.282   0.037   0.025   0.061   0.160
   2            0.682   0.171   0.511   0.067   0.046   0.118   0.304
   3            0.870   0.219   0.651   0.087   0.059   0.169   0.417
   4            0.918   0.231   0.686   0.093   0.064   0.210   0.489
   5            0.828   0.209   0.619   0.085   0.058   0.237   0.502
   6            0.628   0.159   0.468   0.066   0.045   0.248   0.472
   7            0.369   0.094   0.275   0.040   0.027   0.239   0.390
   8            0.125   0.032   0.092   0.013   0.009   0.205   0.278
   9           -0.030  -0.008  -0.023  -0.005  -0.003   0.128   0.138
SUPPORT         0.000   0.000   0.000   0.000   0.000   0.000   0.000
  11            0.476   0.123   0.353   0.063   0.043   0.153   0.299
  12            1.228   0.316   0.912   0.156   0.107   0.273   0.621
  13            1.986   0.509   1.477   0.242   0.166   0.357   0.880
  14            2.510   0.642   1.869   0.298   0.204   0.419   1.056
  15            2.656   0.678   1.978   0.313   0.215   0.461   1.126
  16            2.387   0.610   1.777   0.284   0.195   0.472   1.083
  17            1.774   0.454   1.320   0.217   0.149   0.449   0.931
  18            0.997   0.256   0.741   0.127   0.087   0.380   0.684
  19            0.308   0.079   0.229   0.041   0.028   0.231   0.341
SUPPORT         0.000   0.000   0.000   0.000   0.000   0.000   0.000
  21            0.309   0.080   0.229   0.041   0.028   0.230   0.337
  22            0.998   0.257   0.741   0.127   0.087   0.375   0.671
  23            1.775   0.455   1.320   0.217   0.149   0.446   0.922
  24            2.388   0.611   1.777   0.284   0.195   0.473   1.081
  25            2.657   0.679   1.978   0.313   0.215   0.464   1.129
  26            2.512   0.643   1.869   0.298   0.204   0.424   1.064
  27            1.988   0.511   1.477   0.242   0.166   0.363   0.894
  28            1.231   0.318   0.912   0.157   0.107   0.280   0.637
  29            0.477   0.124   0.353   0.063   0.043   0.156   0.306
SUPPORT         0.000   0.000   0.000   0.000   0.000   0.000   0.000
  31           -0.031  -0.008  -0.023  -0.005  -0.003   0.131   0.139
  32            0.124   0.031   0.092   0.013   0.009   0.208   0.278
  33            0.368   0.093   0.275   0.040   0.027   0.241   0.389
  34            0.626   0.158   0.468   0.066   0.045   0.251   0.471
  35            0.827   0.208   0.619   0.085   0.058   0.240   0.502
  36            0.917   0.230   0.687   0.093   0.064   0.213   0.489
  37            0.869   0.218   0.651   0.087   0.059   0.172   0.418
  38            0.682   0.171   0.511   0.067   0.046   0.120   0.304
  39            0.376   0.094   0.282   0.037   0.025   0.062   0.160
SUPPORT         0.000   0.000   0.000   0.000   0.000   0.000   0.000
 
   Includes sidewalk deflections.
  
   Wearing surface deflections are for future wearing surface.
  
 
Loading for defl uses larger of des trk alone
or 0.25 des truck + full lane
 
   Deflections use a multipresence factor of 0.85 on  3 lanes.
 
 
           Loc

Brace    13.12   0.393   0.099   0.295   0.039   0.026   0.064   0.167
Brace    32.88   0.817   0.205   0.612   0.081   0.056   0.151   0.380
Brace    52.62   0.910   0.230   0.681   0.092   0.063   0.216   0.497
Brace    72.38   0.674   0.171   0.503   0.071   0.049   0.247   0.483
Web Spl  85.00   0.420   0.107   0.313   0.045   0.031   0.242   0.409
Brace    92.12   0.277   0.071   0.206   0.030   0.021   0.229   0.353
Brace   111.88  -0.027  -0.007  -0.020  -0.005  -0.003   0.133   0.145
Brace   125.00   0.000   0.000   0.000   0.000   0.000   0.000   0.000
Brace   137.67   0.306   0.079   0.227   0.041   0.028   0.111   0.208
Brace   157.00   1.061   0.273   0.788   0.136   0.093   0.249   0.555
Web Spl 165.00   1.396   0.359   1.037   0.176   0.121   0.295   0.684
Brace   176.33   1.888   0.484   1.404   0.231   0.158   0.346   0.847
Brace   195.67   2.485   0.635   1.849   0.295   0.202   0.415   1.047
Brace   215.00   2.656   0.678   1.978   0.313   0.215   0.461   1.126
Brace   234.33   2.353   0.601   1.752   0.281   0.192   0.472   1.075
Brace   253.67   1.670   0.427   1.242   0.205   0.141   0.442   0.901
Web Spl 263.00   1.246   0.319   0.927   0.157   0.107   0.412   0.777
Brace   273.00   0.836   0.215   0.622   0.108   0.074   0.354   0.616
Brace   292.33   0.177   0.046   0.131   0.024   0.016   0.171   0.240
Brace   305.00   0.000   0.000   0.000   0.000   0.000   0.000   0.000
Brace   317.67   0.177   0.046   0.131   0.024   0.016   0.171   0.238
Brace   337.00   0.838   0.216   0.622   0.108   0.074   0.349   0.604
Web Spl 347.00   1.248   0.321   0.927   0.157   0.107   0.407   0.764
Brace   356.33   1.671   0.428   1.242   0.205   0.141   0.438   0.891
Brace   375.67   2.354   0.602   1.752   0.281   0.192   0.472   1.073
Brace   395.00   2.657   0.679   1.978   0.313   0.215   0.464   1.129
Brace   414.33   2.486   0.637   1.849   0.296   0.202   0.421   1.055
Brace   433.67   1.891   0.486   1.404   0.231   0.158   0.352   0.861
Web Spl 445.00   1.399   0.361   1.037   0.176   0.121   0.302   0.700
Brace   453.00   1.063   0.275   0.788   0.136   0.093   0.256   0.570
Brace   472.33   0.307   0.080   0.227   0.041   0.028   0.113   0.212
Brace   485.00   0.000   0.000   0.000   0.000   0.000   0.000   0.000
Brace   498.12  -0.027  -0.007  -0.020  -0.005  -0.003   0.136   0.146
Brace   517.87   0.276   0.070   0.206   0.030   0.021   0.232   0.351
Web Spl 525.00   0.419   0.106   0.313   0.045   0.031   0.245   0.407
Brace   537.62   0.673   0.170   0.503   0.071   0.049   0.250   0.482
Brace   557.37   0.909   0.228   0.681   0.092   0.063   0.220   0.497
Brace   577.12   0.816   0.205   0.612   0.081   0.056   0.154   0.380
Brace   596.87   0.393   0.098   0.295   0.039   0.026   0.065   0.168


Positive dead load deflection is downward.
Live load deflection as indicated in column heading.



